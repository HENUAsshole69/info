(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c6ba4a16"],{2743:function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("v-system-bar",{attrs:{"lights-out":""}}),n("v-carousel",{key:e.key,attrs:{continuous:!1,"hide-delimiter-background":""}},e._l(e.images,(function(e,t){return n("v-carousel-item",{key:t,attrs:{src:e}})})),1),n("v-list",{attrs:{"two-line":""}},[n("v-list-item",[n("v-form",{model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[n("pic-input",{on:{change:function(t){e.picB64=t}}})],1)],1),n("v-list-item",[n("v-btn",{attrs:{disabled:!e.valid},on:{click:e.newCover}},[e._v(" 上传 ")]),n("v-btn",{attrs:{disabled:0===e.images.length},on:{click:e.clearCover}},[e._v(" 清空 ")])],1)],1)],1)},r=[],i=(n("96cf"),n("1da1")),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-file-input",{attrs:{accept:"image/png, image/jpeg, image/bmp",placeholder:"选择图片","prepend-icon":"mdi-camera",hint:"请选择图片",label:"图片",rules:e.picRules},on:{change:function(t){return e.picToBase64(t)}}})},c=[],l={name:"PicInput",data:function(){return{picRules:[function(e){return void 0!==e||"图片不可不选"}]}},methods:{picToBase64:function(e){var t=this,n=e,a=new FileReader;a.onload=function(e){return function(e){var n=e.target.result;t.$emit("change",n)}}(),a.readAsArrayBuffer(n)}}},s=l,u=n("2877"),d=Object(u["a"])(s,o,c,!1,null,"2c226b02",null),p=d.exports,v=n("2966"),m={name:"CoverEditor",components:{PicInput:p},props:{id:String},data:function(){return{picB64:null,images:[],key:0,valid:!1}},beforeMount:function(){this.loadPic(0)},methods:{loadPic:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=this.images,e.next=4,v["a"].getCover(this.id,t);case 4:return e.t1=e.sent,e.t2="data:image/jpeg;base64,"+e.t1,e.t0.push.call(e.t0,e.t2),e.next=9,this.loadPic(t+1);case 9:e.next=14;break;case 11:e.prev=11,e.t3=e["catch"](0),console.log(this.images);case 14:case"end":return e.stop()}}),e,this,[[0,11]])})));function t(t){return e.apply(this,arguments)}return t}(),newCover:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.t0=console,t.next=3,v["a"].postCover(e.id,e.picB64);case 3:return t.t1=t.sent,t.t0.log.call(t.t0,t.t1),e.images.length=0,t.next=8,e.loadPic(0);case 8:case"end":return t.stop()}}),t)})))()},clearCover:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,v["a"].delCover(e.id);case 2:e.images.length=0,e.key++;case 4:case"end":return t.stop()}}),t)})))()}}},f=m,h=Object(u["a"])(f,a,r,!1,null,"cf4ee98a",null);t["a"]=h.exports},c105:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-container",[n("v-row",[n("v-col",[n("type-select",{on:{change:function(t){e.type=t}}})],1)],1),n("v-row",[n("v-col",[n("admin-table",{key:e.type,attrs:{repo:e.repo()}})],1)],1)],1)},r=[],i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{key:e.key},[n("jpa-data-table",{attrs:{repo:e.repo,"data-table-props":{"multi-sort":!0,"footer-props":{"items-per-page-text":"每页显示项数:","items-per-page-all-text":"所有项"},"no-data-text":"无数据"}},scopedSlots:e._u([{key:"footer.page-text",fn:function(t){var n=t.pageStart,a=t.pageStop,r=t.itemsLength;return[e._v(" "+e._s("从第"+n+"项至第"+a+"项，共"+r+"项")+" ")]}},{key:"item.actions",fn:function(t){var a=t.item;return["ADMIN"===e.$store.state.userObj.type?n("publish-btn",e._b({},"publish-btn",a,!1)):e._e(),n("del-btn",e._b({on:{deleted:function(t){e.key++}}},"del-btn",a,!1)),n("edit-btn",e._b({},"edit-btn",a,!1)),n("v-btn",{staticClass:"ma-2",attrs:{tile:"",outlined:"",color:"success"},on:{click:function(t){return e.editCover(a)}}},[n("v-icon",{attrs:{left:""}},[e._v("mdi-book")]),e._v(" 图片编辑 ")],1)]}},{key:"item.headline",fn:function(t){var a=t.item;return[n("headline-checkbox",{attrs:{id:a.id},model:{value:a.headline,callback:function(t){e.$set(a,"headline",t)},expression:"item.headline"}})]}},{key:"item.time",fn:function(t){var n=t.item;return[e._v(" "+e._s(new Date(n.time).toLocaleDateString())+" ")]}}])}),n("cover-editor-dialog",{key:e.id,attrs:{dialog:e.dialog,id:e.id},on:{close:function(t){e.dialog=!1}}})],1)},o=[],c=(n("d3b7"),n("25f0"),n("87f6")),l=n("0e9e"),s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-btn",{staticClass:"ma-2",attrs:{loading:e.loading,disabled:e.published||e.done,tile:"",outlined:"",color:"success"},on:{click:e.publish}},[n("v-icon",{attrs:{left:""}},[e._v("mdi-publish")]),e._v(" "+e._s(e.published||e.done?"已发布":"发布")+" ")],1)},u=[],d=(n("a9e3"),n("96cf"),n("1da1")),p=n("2966"),v={name:"PublishBtn",props:{id:Number,published:Boolean},data:function(){return{loading:!1,done:!1}},methods:{publish:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,p["a"].publish(e.id);case 3:e.loading=!1,e.done=!0,e.$emit("published");case 6:case"end":return t.stop()}}),t)})))()}}},m=v,f=n("2877"),h=Object(f["a"])(m,s,u,!1,null,"74fca084",null),b=h.exports,g=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-btn",{staticClass:"ma-2",attrs:{loading:e.loading,tile:"",outlined:"",color:"success"},on:{click:e.publish}},[n("v-icon",{attrs:{left:""}},[e._v("mdi-trash-can-outline")]),e._v(" 删除 ")],1)},x=[],k={name:"DelBtn",props:{id:Number,published:Boolean},data:function(){return{loading:!1}},methods:{publish:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,p["a"].delete(e.id);case 3:e.loading=!1,e.$emit("deleted");case 5:case"end":return t.stop()}}),t)})))()}}},_=k,w=Object(f["a"])(_,g,x,!1,null,"baf3657c",null),y=w.exports,O=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-btn",{staticClass:"ma-2",attrs:{loading:e.loading,tile:"",outlined:"",color:"success"},on:{click:e.publish}},[n("v-icon",{attrs:{left:""}},[e._v("mdi-pencil")]),e._v(" 编辑 ")],1)},j=[],E={name:"EditBtn",props:{id:Number,published:Boolean},data:function(){return{loading:!1}},methods:{publish:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,e.$router.push("/edit/"+e.id);case 3:e.loading=!1;case 4:case"end":return t.stop()}}),t)})))()}}},C=E,I=Object(f["a"])(C,O,j,!1,null,"63c9aa2b",null),$=I.exports,B=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-dialog",{attrs:{persistent:"","max-width":"600px"},on:{close:function(t){return e.$emit("close")}},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[n("v-card",[n("v-card-text",[n("v-container",[n("v-row",[n("v-col",[n("cover-editor",{attrs:{id:e.id}})],1)],1)],1)],1),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:function(t){return e.$emit("close")}}},[e._v("关闭")])],1)],1)],1)},N=[],R=n("2743"),T={name:"CoverEditorDialog",components:{CoverEditor:R["a"]},props:{id:String,dialog:Boolean}},A=T,S=Object(f["a"])(A,B,N,!1,null,"0a3d27b3",null),D=S.exports,P=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-simple-checkbox",{model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})},H=[],M={name:"HeadlineCheckbox",props:{id:Number,published:Boolean,headline:Boolean},data:function(){return{value:null}},mounted:function(){this.value=this.headline},model:{prop:"headline",event:"change"},watch:{value:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.$emit("change",e),!e){n.next=9;break}return n.t0=console,n.next=5,p["a"].postHeadline(t.id);case 5:n.t1=n.sent,n.t0.log.call(n.t0,n.t1),n.next=14;break;case 9:return n.t2=console,n.next=12,p["a"].delHeadline(t.id);case 12:n.t3=n.sent,n.t2.log.call(n.t2,n.t3);case 14:case"end":return n.stop()}}),n)})))()}}},X=M,J=Object(f["a"])(X,P,H,!1,null,"85f7fab2",null),L=J.exports,U={name:"AdminTable",components:{HeadlineCheckbox:L,CoverEditorDialog:D,EditBtn:$,DelBtn:y,PublishBtn:b,JpaDataTable:c["a"]},data:function(){return{dialog:!1,id:null,key:0}},props:{repo:Object},methods:{editCover:function(e){this.id=e.id.toString(),this.dialog=!0}}},W=U,F=Object(f["a"])(W,i,o,!1,null,"0870a7f0",null),Y=F.exports,V=n("d893"),q=n("b85c"),z=n("7670"),G=n("8d8d"),K=function(e){return function(){var t=Object(d["a"])(regeneratorRuntime.mark((function t(n){var a,r,i,o,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,G["a"].post("/article/page/type/"+e+"/user",n,{});case 2:a=t.sent.data,r=[],i=Object(q["a"])(a.content);try{for(i.s();!(o=i.n()).done;)c=o.value,r.push(new z["a"](c))}catch(l){i.e(l)}finally{i.f()}return a.content=r,t.abrupt("return",a);case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},Q={name:"ArticleManagement",components:{TypeSelect:V["a"],AdminTable:Y},data:function(){return{type:"NEWS"}},methods:{repo:function(){return"ADMIN"===this.$store.state.userObj.type?{fetch:Object(l["a"])(this.type,void 0)}:{fetch:K(this.type)}}},created:function(){"ADMIN"!==this.$store.state.userObj.type&&(this.type="EXHIBITION")}},Z=Q,ee=Object(f["a"])(Z,a,r,!1,null,"4a1484aa",null);t["default"]=ee.exports},d893:function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-select",{attrs:{items:e.items,label:"类型",rules:e.rules},on:{change:function(t){return e.$emit("change",t)}},model:{value:e.val,callback:function(t){e.val=t},expression:"val"}})},r=[],i=(n("4de4"),n("2909")),o={name:"TypeSelect",data:function(){return{val:"NEWS",items:[{value:"NEWS",text:"新闻"},{value:"ACTIVITY",text:"活动"},{value:"POLICY",text:"政策"},{value:"ANNOUNCE",text:"公告"},{value:"TAX_FREE",text:"免税"},{value:"EXHIBITION",text:"展览"},{value:"AUCTION",text:"拍卖"}],rules:[function(e){return void 0!==e||"不可不选"}]}},created:function(){if("ADMIN"!==this.$store.state.userObj.type){var e,t=this.items.filter((function(e){return"EXHIBITION"===e.value||"AUCTION"===e.value}));this.items.length=0,(e=this.items).push.apply(e,Object(i["a"])(t)),this.val="EXHIBITION"}}},c=o,l=n("2877"),s=Object(l["a"])(c,a,r,!1,null,"4f6eb1c1",null);t["a"]=s.exports}}]);
//# sourceMappingURL=chunk-c6ba4a16.ed9be649.js.map